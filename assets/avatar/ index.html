<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Laborat√≥rio Avatar V4 (Editor de Piv√¥)</title>
    <style>
        body { 
            background: #1e1e1e; 
            color: #eee; 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* BARRA DE TOPO (ABAS) */
        .top-bar {
            background: #2d2d2d;
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #444;
        }
        .tab-btn {
            padding: 10px 20px;
            background: #444;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }
        .tab-btn.active { background: #FF5722; }

        /* √ÅREA PRINCIPAL */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* TELAS (Abas) */
        .screen { display: none; width: 100%; height: 100%; }
        .screen.active { display: flex; }

        /* --- TELA DE ANIMA√á√ÉO --- */
        .anim-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #111;
            position: relative;
        }
        canvas { 
            background: url('https://i.imgur.com/3M7qL9p.png'); 
            border: 2px solid #555; 
            border-radius: 8px; 
        }
        .controls { 
            width: 320px; 
            background: #252526; 
            padding: 20px; 
            border-left: 1px solid #444;
            overflow-y: auto;
        }

        /* --- TELA DE PIV√î --- */
        .pivot-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #222;
        }
        .parts-list {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .part-btn {
            padding: 8px 15px;
            background: #444;
            border: 1px solid #666;
            color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .part-btn.selected { background: #2196F3; border-color: #64B5F6; }
        
        #pivotCanvas {
            cursor: crosshair;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* SLIDERS */
        .slider-group { margin-bottom: 15px; }
        .slider-header { display: flex; justify-content: space-between; font-size: 0.8rem; color: #aaa; margin-bottom: 4px; }
        input[type=range] { width: 100%; cursor: pointer; }

        .btn-export {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div class="top-bar">
        <button class="tab-btn active" onclick="mudarAba('animacao')">üé¨ Anima√ß√£o & Posi√ß√£o</button>
        <button class="tab-btn" onclick="mudarAba('pivo')">üìç Editor de Piv√¥ (Juntas)</button>
    </div>

    <div class="main-content">
        
        <!-- ABA 1: ANIMA√á√ÉO -->
        <div id="screen-animacao" class="screen active">
            <div class="anim-container">
                <canvas id="gameCanvas" width="600" height="800"></canvas>
            </div>
            <div class="controls">
                <h3>Ajuste de Posi√ß√£o (X/Y)</h3>
                
                <div class="slider-group">
                    <div class="slider-header"><span>Zoom</span></div>
                    <input type="range" id="globalScale" min="1" max="15" value="5">
                </div>
                <div class="slider-group">
                    <div class="slider-header"><span>Velocidade</span></div>
                    <input type="range" id="speed" min="0" max="100" value="20">
                </div>

                <hr style="border-color:#444">

                <div class="slider-group">
                    <div class="slider-header"><span>Cabe√ßa Y</span> <span id="val-head">0</span></div>
                    <input type="range" id="headY" min="-300" max="100" value="-120">
                </div>

                <div class="slider-group">
                    <div class="slider-header"><span>Bra√ßos Y (Altura)</span> <span id="val-arm">0</span></div>
                    <input type="range" id="armY" min="-200" max="200" value="-80">
                </div>
                
                <!-- AGORA VAI DE NEGATIVO A POSITIVO -->
                <div class="slider-group">
                    <div class="slider-header"><span>Bra√ßos X (Lado)</span> <span id="val-spread">0</span></div>
                    <input type="range" id="spreadX" min="-150" max="150" value="60">
                </div>

                <div class="slider-group">
                    <div class="slider-header"><span>Pernas Y (Altura)</span> <span id="val-leg">0</span></div>
                    <input type="range" id="legY" min="-100" max="300" value="80">
                </div>
                
                <!-- AGORA VAI DE NEGATIVO A POSITIVO -->
                <div class="slider-group">
                    <div class="slider-header"><span>Pernas X (Lado)</span> <span id="val-legspread">0</span></div>
                    <input type="range" id="legSpread" min="-150" max="150" value="30">
                </div>

                <button class="btn-export" onclick="exportarDados()">üíæ EXPORTAR DADOS</button>
            </div>
        </div>

        <!-- ABA 2: EDITOR DE PIV√î -->
        <div id="screen-pivo" class="screen">
            <div class="pivot-editor">
                <h3 style="margin-bottom:10px;">Selecione a pe√ßa e clique onde √© a junta</h3>
                <div class="parts-list" id="partsList"></div>
                <canvas id="pivotCanvas" width="400" height="400"></canvas>
                <p style="color:#888; font-size:0.9rem;">O ponto vermelho √© onde a pe√ßa vai girar.</p>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIGURA√á√ÉO INICIAL ---
        const parts = ['cabeca', 'tronco', 'braco_frente', 'braco_tras', 'perna_frente', 'perna_tras'];
        const images = {};
        
        // DADOS GLOBAIS (Aqui ficam salvos os piv√¥s)
        // Padr√£o inicial (meio, topo)
        const pivots = {
            cabeca: { x: 0.5, y: 0.9 },
            tronco: { x: 0.5, y: 0.5 },
            braco_frente: { x: 0.5, y: 0.1 },
            braco_tras: { x: 0.5, y: 0.1 },
            perna_frente: { x: 0.5, y: 0.1 },
            perna_tras: { x: 0.5, y: 0.1 }
        };

        let loadedCount = 0;
        let currentPart = 'cabeca'; // Pe√ßa sendo editada no piv√¥

        // --- CARREGAMENTO ---
        parts.forEach(name => {
            const img = new Image();
            img.src = `img/${name}.png`;
            img.onload = () => {
                loadedCount++;
                if(loadedCount === parts.length) {
                    init();
                }
            };
            images[name] = img;
        });

        function init() {
            // Cria bot√µes do editor de piv√¥
            const list = document.getElementById('partsList');
            parts.forEach(p => {
                const btn = document.createElement('button');
                btn.innerText = p;
                btn.className = 'part-btn';
                btn.onclick = () => selecionarPecaEditor(p, btn);
                list.appendChild(btn);
            });
            
            // Seleciona o primeiro
            selecionarPecaEditor('cabeca', list.children[0]);

            // Inicia loops
            requestAnimationFrame(loopAnimacao);
            drawEditor();
        }

        // --- L√ìGICA DE ABAS ---
        function mudarAba(aba) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('screen-' + aba).classList.add('active');
            event.target.classList.add('active');
        }

        // --- L√ìGICA DO EDITOR DE PIV√î ---
        const pCanvas = document.getElementById('pivotCanvas');
        const pCtx = pCanvas.getContext('2d');

        function selecionarPecaEditor(name, btnElement) {
            currentPart = name;
            document.querySelectorAll('.part-btn').forEach(b => b.classList.remove('selected'));
            btnElement.classList.add('selected');
            drawEditor();
        }

        pCanvas.addEventListener('mousedown', (e) => {
            const rect = pCanvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const img = images[currentPart];
            if(!img) return;

            // Centraliza√ß√£o da imagem no canvas do editor
            const scale = Math.min(300 / img.width, 300 / img.height);
            const drawW = img.width * scale;
            const drawH = img.height * scale;
            const startX = (pCanvas.width - drawW) / 2;
            const startY = (pCanvas.height - drawH) / 2;

            // Calcula a posi√ß√£o relativa (0.0 a 1.0) dentro da imagem
            let relX = (mouseX - startX) / drawW;
            let relY = (mouseY - startY) / drawH;

            // Salva no objeto global
            pivots[currentPart] = { x: relX, y: relY };
            drawEditor();
        });

        function drawEditor() {
            pCtx.clearRect(0, 0, pCanvas.width, pCanvas.height);
            
            // Linhas guia
            pCtx.strokeStyle = '#333';
            pCtx.beginPath(); pCtx.moveTo(200,0); pCtx.lineTo(200,400); pCtx.stroke();
            pCtx.beginPath(); pCtx.moveTo(0,200); pCtx.lineTo(400,200); pCtx.stroke();

            const img = images[currentPart];
            if(!img) return;

            const scale = Math.min(300 / img.width, 300 / img.height);
            const drawW = img.width * scale;
            const drawH = img.height * scale;
            const startX = (pCanvas.width - drawW) / 2;
            const startY = (pCanvas.height - drawH) / 2;

            pCtx.drawImage(img, startX, startY, drawW, drawH);

            // Desenha o Piv√¥ Atual
            const p = pivots[currentPart];
            const px = startX + (p.x * drawW);
            const py = startY + (p.y * drawH);

            pCtx.fillStyle = '#FF0000';
            pCtx.beginPath(); pCtx.arc(px, py, 6, 0, Math.PI*2); pCtx.fill();
            pCtx.strokeStyle = 'white';
            pCtx.lineWidth = 2;
            pCtx.stroke();
        }

        // --- L√ìGICA DA ANIMA√á√ÉO ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let time = 0;

        function getConfig() {
            // Atualiza textos
            ['head', 'arm', 'leg', 'spread', 'legspread'].forEach(id => {
                const el = document.getElementById('val-' + id);
                if(el) el.innerText = document.getElementById(id === 'spread' ? 'spreadX' : (id === 'legspread' ? 'legSpread' : id + 'Y')).value;
            });

            return {
                scale: document.getElementById('globalScale').value / 10,
                speed: document.getElementById('speed').value / 400,
                headY: parseInt(document.getElementById('headY').value),
                armY: parseInt(document.getElementById('armY').value),
                legY: parseInt(document.getElementById('legY').value),
                spreadX: parseInt(document.getElementById('spreadX').value),
                legSpread: parseInt(document.getElementById('legSpread').value)
            };
        }

        function drawPart(name, x, y, rot, scale) {
            const img = images[name];
            const piv = pivots[name]; // Pega o piv√¥ configurado na outra aba
            
            if (!img) return;
            
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rot);
            
            const w = img.width * scale;
            const h = img.height * scale;

            // Usa o piv√¥ din√¢mico
            ctx.drawImage(img, -w * piv.x, -h * piv.y, w, h);
            
            // Debug Piv√¥
            ctx.fillStyle = 'red'; ctx.beginPath(); ctx.arc(0,0,3,0,Math.PI*2); ctx.fill();
            
            ctx.restore();
        }

        function loopAnimacao() {
            const cfg = getConfig();
            time += cfg.speed;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;

            const walk = Math.sin(time); 
            const breathe = Math.sin(time * 0.5) * 0.05;
            const bob = Math.abs(Math.sin(time)) * 10;

            // 1. PERNA TR√ÅS
            ctx.filter = "brightness(0.7)";
            drawPart('perna_tras', cx + cfg.legSpread, cy + cfg.legY - bob, -walk * 0.5, cfg.scale);
            ctx.filter = "none";

            // 2. BRA√áO TR√ÅS
            ctx.filter = "brightness(0.8)";
            drawPart('braco_tras', cx + (cfg.spreadX * 0.8), cy + cfg.armY - bob, walk * 0.6, cfg.scale);
            ctx.filter = "none";

            // 3. TRONCO
            drawPart('tronco', cx, cy - bob, 0, cfg.scale);

            // 4. CABE√áA
            drawPart('cabeca', cx, cy + cfg.headY - bob + (breathe * 5), breathe * 0.2, cfg.scale);

            // 5. PERNA FRENTE
            drawPart('perna_frente', cx - cfg.legSpread, cy + cfg.legY - bob, walk * 0.5, cfg.scale);

            // 6. BRA√áO FRENTE
            drawPart('braco_frente', cx - cfg.spreadX, cy + cfg.armY - bob, -walk * 0.6, cfg.scale);

            requestAnimationFrame(loopAnimacao);
        }

        function exportarDados() {
            const cfg = getConfig();
            const dadosFinais = {
                offsets: {
                    headY: cfg.headY,
                    armY: cfg.armY,
                    legY: cfg.legY,
                    spreadX: cfg.spreadX,
                    legSpread: cfg.legSpread
                },
                pivots: pivots
            };
            
            const texto = JSON.stringify(dadosFinais, null, 2);
            alert("Dados copiados para o console! (F12)");
            console.log("--- COPIE O C√ìDIGO ABAIXO PARA O SEU SITE ---");
            console.log(texto);
            console.log("---------------------------------------------");
        }
    </script>
</body>

</html>
