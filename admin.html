<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - KN Jogos</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 20px; max-width: 800px; margin: 0 auto; color: #333; }
        
        /* TELA DE BLOQUEIO (LOGIN) */
        #lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #111, #333); z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        .login-box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.2); }
        .login-btn { background: #FF5722; color: white; padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px; transition: 0.3s; box-shadow: 0 4px 15px rgba(255, 87, 34, 0.4); }
        .login-btn:hover { transform: scale(1.05); background: #E64A19; }
        
        /* CONTE√öDO (ESCONDIDO AT√â LOGAR) */
        #admin-content { display: none; }

        /* EDITOR */
        .editor-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #FF5722; }
        h2 { margin-top: 0; color: #FF5722; }
        label { font-weight: bold; font-size: 0.85rem; display: block; margin-top: 15px; color: #555; text-transform: uppercase; }
        input, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; background: #fafafa; }
        
        /* BOT√ïES */
        .btn-row { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-save { background: #2196F3; color: white; }
        .btn-clear { background: #9E9E9E; color: white; }

        /* LISTA */
        .list-container { margin-top: 40px; }
        .game-item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; cursor: pointer; border: 1px solid transparent; }
        .game-item:hover { border-color: #2196F3; transform: translateX(5px); }
        .game-id { font-family: monospace; color: #D81B60; background: #FCE4EC; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>

    <!-- 1. TELA DE BLOQUEIO (LOGIN) -->
    <div id="lock-screen">
        <div class="login-box">
            <h1 style="margin:0">üîí √Årea Restrita</h1>
            <p style="color:#ccc;">Apenas o Dono (Adenilson) pode acessar.</p>
            <button class="login-btn" id="btn-login">üîë ENTRAR COM GOOGLE</button>
            <p id="error-msg" style="color:#ff5252; font-weight:bold; margin-top:15px; display:none;"></p>
        </div>
    </div>

    <!-- 2. CONTE√öDO DO ADMIN -->
    <div id="admin-content">
        <div id="status" style="text-align:center; padding:10px; margin-bottom:10px; font-weight:bold; display:none;"></div>

        <div class="editor-card" id="topo">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>‚úèÔ∏è Painel de Controle</h2>
                <button onclick="sair()" style="width:auto; background:#333; font-size:0.8rem; padding:5px 15px; margin:0;">Sair</button>
            </div>
            
            <label>ID do Jogo (√önico)</label>
            <input type="text" id="idJogo" placeholder="ex: neonrunner">

            <label>Nome Vis√≠vel</label>
            <input type="text" id="nome" placeholder="ex: Neon Runner 3D">

            <label>Descri√ß√£o</label>
            <input type="text" id="desc" placeholder="ex: Desvie dos obst√°culos...">

            <div style="display:flex; gap:10px;">
                <div style="flex:1;">
                    <label>Arquivo (/jogos)</label>
                    <input type="text" id="arquivo" placeholder="ex: neon.html">
                </div>
                <div style="flex:1;">
                    <label>Imagem (/capas)</label>
                    <input type="text" id="img" placeholder="ex: neon.jpg">
                </div>
            </div>

            <div class="btn-row">
                <button class="btn-clear" onclick="limparFormulario()">üßπ Novo</button>
                <button class="btn-save" onclick="salvarJogo()">üíæ SALVAR NO SITE</button>
            </div>
        </div>

        <div class="list-container">
            <h3>üìÇ Jogos no Banco de Dados</h3>
            <div id="lista-jogos">Carregando...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- CONFIGURA√á√ÉO (SEU PROJETO) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBIR7CqYYvMZVQxtO67JCQoJ3OLT1cvAx8",
            authDomain: "kn-jogos.firebaseapp.com",
            projectId: "kn-jogos",
            storageBucket: "kn-jogos.firebasestorage.app",
            messagingSenderId: "273132829744",
            appId: "1:273132829744:web:a03e85b80ffabfa24101f5",
            measurementId: "G-CX4Z8R1S6F"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // --- E-MAIL PERMITIDO ---
        const ADMIN_EMAIL = "adenilsonantonioromao@gmail.com";

        // --- LOGIN COM PROTE√á√ÉO ---
        document.getElementById('btn-login').addEventListener('click', () => {
            signInWithPopup(auth, provider).catch(e => alert("Erro: " + e.message));
        });

        onAuthStateChanged(auth, (user) => {
            const errorMsg = document.getElementById('error-msg');
            
            if (user) {
                // VERIFICA SE √â O DONO
                if (user.email === ADMIN_EMAIL) {
                    // SUCESSO: Libera o painel
                    document.getElementById('lock-screen').style.display = 'none';
                    document.getElementById('admin-content').style.display = 'block';
                    carregarLista();
                } else {
                    // FALHA: E-mail errado
                    errorMsg.style.display = 'block';
                    errorMsg.innerText = `‚õî ACESSO NEGADO! O e-mail ${user.email} n√£o tem permiss√£o.`;
                    signOut(auth); // Desloga o intruso imediatamente
                }
            }
        });

        window.sair = function() {
            signOut(auth).then(() => {
                location.reload();
            });
        }

        // --- SISTEMA DE CADASTRO (IGUAL ANTES) ---
        window.carregarLista = async function() {
            const divLista = document.getElementById('lista-jogos');
            divLista.innerHTML = "Lendo banco de dados...";
            
            try {
                const querySnapshot = await getDocs(collection(db, "listaJogos"));
                divLista.innerHTML = "";
                
                if (querySnapshot.empty) {
                    divLista.innerHTML = "<p>Nenhum jogo encontrado.</p>";
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const item = document.createElement('div');
                    item.className = 'game-item';
                    item.innerHTML = `
                        <div>
                            <span class="game-id">${data.id}</span>
                            <strong>${data.nome}</strong>
                        </div>
                        <span style="font-size:1.2rem">‚úèÔ∏è</span>
                    `;
                    item.onclick = () => preencherEditor(data);
                    divLista.appendChild(item);
                });
            } catch (e) {
                divLista.innerHTML = `<p style="color:red">Erro: ${e.message}</p>`;
            }
        }

        function preencherEditor(data) {
            document.getElementById('idJogo').value = data.id;
            document.getElementById('nome').value = data.nome;
            document.getElementById('desc').value = data.desc;
            document.getElementById('arquivo').value = data.arquivo;
            document.getElementById('img').value = data.img;
            document.getElementById('topo').scrollIntoView({ behavior: 'smooth' });
            
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.style.background = '#fff3cd';
            status.innerText = `Editando: ${data.nome}`;
        }

        window.salvarJogo = async function() {
            const id = document.getElementById('idJogo').value.toLowerCase().trim();
            const nome = document.getElementById('nome').value;
            const desc = document.getElementById('desc').value;
            const arquivo = document.getElementById('arquivo').value;
            const img = document.getElementById('img').value;

            if(!id || !arquivo) { alert("ID e Arquivo s√£o obrigat√≥rios!"); return; }

            try {
                await setDoc(doc(db, "listaJogos", id), {
                    id, nome, desc, arquivo, img,
                    dataUpdate: new Date()
                }, { merge: true });

                await setDoc(doc(db, "config", "gameStats"), { [id]: 0 }, { merge: true });

                const status = document.getElementById('status');
                status.style.display = 'block';
                status.style.background = '#d4edda';
                status.style.color = '#155724';
                status.innerText = "‚úÖ Jogo Salvo com Sucesso!";
                
                carregarLista();

            } catch (e) {
                alert("Erro ao salvar: " + e.message);
            }
        }

        window.limparFormulario = function() {
            document.getElementById('idJogo').value = "";
            document.getElementById('nome').value = "";
            document.getElementById('desc').value = "";
            document.getElementById('arquivo').value = "";
            document.getElementById('img').value = "";
            document.getElementById('status').style.display = 'none';
        }
    </script>
</body>
</html>
