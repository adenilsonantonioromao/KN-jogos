<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - KN Jogos</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 20px; max-width: 800px; margin: 0 auto; color: #333; }
        
        /* TELA DE BLOQUEIO */
        #lock-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #111, #333); z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; }
        .login-box { background: rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.2); }
        .login-btn { background: #FF5722; color: white; padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        
        #admin-content { display: none; }
        
        /* ABAS DE NAVEGA√á√ÉO */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 15px; background: #ddd; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; color: #666; }
        .tab-btn.active { background: #FF5722; color: white; box-shadow: 0 4px 10px rgba(255, 87, 34, 0.3); }

        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* EDITOR */
        .editor-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid #FF5722; }
        label { font-weight: bold; font-size: 0.85rem; display: block; margin-top: 15px; color: #555; text-transform: uppercase; }
        input, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; background: #fafafa; }
        
        .btn-row { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn-save { background: #2196F3; color: white; }
        .btn-clear { background: #9E9E9E; color: white; }
        .btn-delete { background: #ff4444; color: white; flex: 0.3; }

        /* LISTAS */
        .list-container { margin-top: 40px; }
        .item-list { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; cursor: pointer; border: 1px solid transparent; }
        .item-list:hover { border-color: #2196F3; transform: translateX(5px); }
        .date-badge { font-size: 0.75rem; color: #666; background: #eee; padding: 2px 8px; border-radius: 10px; margin-top: 4px; display: inline-block; }
        
        /* Banner Preview */
        .banner-preview { width: 100px; height: 40px; background: #333; object-fit: cover; border-radius: 5px; margin-right: 10px; }
    </style>
</head>
<body>

    <div id="lock-screen">
        <div class="login-box">
            <h1 style="margin:0">üîí √Årea Restrita</h1>
            <button class="login-btn" id="btn-login">üîë ENTRAR COM GOOGLE</button>
            <p id="error-msg" style="color:#ff5252; font-weight:bold; margin-top:15px; display:none;"></p>
        </div>
    </div>

    <div id="admin-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2>‚öôÔ∏è Painel de Controle</h2>
            <button onclick="sair()" style="width:auto; background:#333; font-size:0.8rem; padding:5px 15px; margin:0; color:white;">Sair</button>
        </div>

        <!-- ABAS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="mudarAba('jogos')">üéÆ Gerenciar Jogos</button>
            <button class="tab-btn" onclick="mudarAba('banners')">üñºÔ∏è Gerenciar Banners</button>
        </div>

        <div id="status" style="text-align:center; padding:10px; margin-bottom:10px; font-weight:bold; display:none;"></div>

        <!-- CONTE√öDO: JOGOS -->
        <div id="tab-jogos" class="tab-content active">
            <div class="editor-card">
                <h3>Novo/Editar Jogo</h3>
                <label>ID do Jogo (√önico)</label>
                <input type="text" id="idJogo" placeholder="ex: neonrunner">
                <label>Nome Vis√≠vel</label>
                <input type="text" id="nome" placeholder="ex: Neon Runner 3D">
                <label>Descri√ß√£o</label>
                <input type="text" id="desc" placeholder="ex: Desvie dos obst√°culos...">
                <div style="display:flex; gap:10px;">
                    <div style="flex:1;"><label>Arquivo (/jogos)</label><input type="text" id="arquivo" placeholder="ex: neon.html"></div>
                    <div style="flex:1;"><label>Imagem (/capas)</label><input type="text" id="img" placeholder="ex: neon.jpg"></div>
                </div>
                <div class="btn-row">
                    <button class="btn-clear" onclick="limparFormulario()">üßπ Limpar</button>
                    <button class="btn-save" onclick="salvarJogo()">üíæ SALVAR JOGO</button>
                </div>
            </div>
            <div class="list-container">
                <h3>üìÇ Jogos Cadastrados</h3>
                <div id="lista-jogos">Carregando...</div>
            </div>
        </div>

        <!-- CONTE√öDO: BANNERS -->
        <div id="tab-banners" class="tab-content">
            <div class="editor-card" style="border-left-color: #9C27B0;">
                <h3>Novo/Editar Banner</h3>
                <label>ID do Banner (Autom√°tico ou Manual)</label>
                <input type="text" id="idBanner" placeholder="ex: banner_natal">
                <div style="display:flex; gap:10px;">
                    <div style="flex:2;"><label>Arquivo de Imagem (/banners)</label><input type="text" id="arquivoBanner" placeholder="ex: promo1.jpg"></div>
                    <div style="flex:1;"><label>Ordem (1, 2, 3...)</label><input type="number" id="ordemBanner" placeholder="1"></div>
                </div>
                <div class="btn-row">
                    <button class="btn-clear" onclick="limparFormularioBanner()">üßπ Limpar</button>
                    <button class="btn-delete" onclick="deletarBanner()">üóëÔ∏è Deletar</button>
                    <button class="btn-save" style="background: #9C27B0;" onclick="salvarBanner()">üíæ SALVAR BANNER</button>
                </div>
            </div>
            <div class="list-container">
                <h3>üñºÔ∏è Banners Ativos</h3>
                <div id="lista-banners">Carregando...</div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBIR7CqYYvMZVQxtO67JCQoJ3OLT1cvAx8",
            authDomain: "kn-jogos.firebaseapp.com",
            projectId: "kn-jogos",
            storageBucket: "kn-jogos.firebasestorage.app",
            messagingSenderId: "273132829744",
            appId: "1:273132829744:web:a03e85b80ffabfa24101f5",
            measurementId: "G-CX4Z8R1S6F"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        const ADMIN_EMAIL = "adenilsonantonioromao@gmail.com";

        // --- AUTH ---
        document.getElementById('btn-login').addEventListener('click', () => { signInWithPopup(auth, provider).catch(alert); });
        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ADMIN_EMAIL) {
                document.getElementById('lock-screen').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                carregarListaJogos();
                carregarListaBanners();
            } else if (user) {
                document.getElementById('error-msg').style.display = 'block';
                document.getElementById('error-msg').innerText = "Acesso Negado.";
                signOut(auth);
            }
        });
        window.sair = () => signOut(auth).then(() => location.reload());

        // --- NAVEGA√á√ÉO DE ABAS ---
        window.mudarAba = function(aba) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + aba).classList.add('active');
            // Adiciona classe active no bot√£o clicado (l√≥gica simples via event n√£o funciona bem aqui, ent√£o buscamos pelo texto ou √≠ndice, mas vamos simplificar)
            const btns = document.querySelectorAll('.tab-btn');
            if(aba === 'jogos') btns[0].classList.add('active');
            else btns[1].classList.add('active');
        }

        // --- GERENCIAMENTO DE JOGOS ---
        window.carregarListaJogos = async function() {
            const divLista = document.getElementById('lista-jogos');
            divLista.innerHTML = "Lendo...";
            try {
                const querySnapshot = await getDocs(collection(db, "listaJogos"));
                divLista.innerHTML = "";
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const item = document.createElement('div');
                    item.className = 'item-list';
                    const dataInc = data.dataInclusao ? new Date(data.dataInclusao).toLocaleDateString('pt-BR') : 'Sem data';
                    item.innerHTML = `
                        <div><span style="font-family:monospace; background:#eee; padding:2px;">${data.id}</span> <strong>${data.nome}</strong><br><span class="date-badge">${dataInc}</span></div>
                        <span>‚úèÔ∏è</span>
                    `;
                    item.onclick = () => preencherEditorJogo(data);
                    divLista.appendChild(item);
                });
            } catch (e) { divLista.innerHTML = "Erro."; }
        }

        function preencherEditorJogo(data) {
            document.getElementById('idJogo').value = data.id;
            document.getElementById('nome').value = data.nome;
            document.getElementById('desc').value = data.desc;
            document.getElementById('arquivo').value = data.arquivo;
            document.getElementById('img').value = data.img;
            mostrarStatus(`Editando Jogo: ${data.nome}`);
        }

        window.salvarJogo = async function() {
            const id = document.getElementById('idJogo').value.toLowerCase().trim();
            const nome = document.getElementById('nome').value;
            const desc = document.getElementById('desc').value;
            const arquivo = document.getElementById('arquivo').value;
            const img = document.getElementById('img').value;
            if(!id) return alert("ID obrigat√≥rio");

            const docRef = doc(db, "listaJogos", id);
            const docSnap = await getDoc(docRef);
            const agora = new Date().toISOString();
            let dados = { id, nome, desc, arquivo, img, dataAtualizacao: agora };
            if (!docSnap.exists()) dados.dataInclusao = agora;

            await setDoc(docRef, dados, { merge: true });
            await setDoc(doc(db, "config", "gameStats"), { [id]: 0 }, { merge: true });
            mostrarStatus("‚úÖ Jogo Salvo!");
            carregarListaJogos();
        }

        // --- GERENCIAMENTO DE BANNERS ---
        window.carregarListaBanners = async function() {
            const divLista = document.getElementById('lista-banners');
            divLista.innerHTML = "Lendo...";
            try {
                const querySnapshot = await getDocs(collection(db, "listaBanners"));
                divLista.innerHTML = "";
                let banners = [];
                querySnapshot.forEach((doc) => banners.push(doc.data()));
                banners.sort((a, b) => a.ordem - b.ordem); // Ordena por ordem

                banners.forEach((data) => {
                    const item = document.createElement('div');
                    item.className = 'item-list';
                    item.innerHTML = `
                        <div style="display:flex; align-items:center;">
                            <span style="font-weight:bold; font-size:1.2rem; margin-right:15px; color:#9C27B0;">#${data.ordem}</span>
                            <div><strong>${data.arquivo}</strong><br><span style="font-size:0.8rem; color:#888;">ID: ${data.id}</span></div>
                        </div>
                        <span>‚úèÔ∏è</span>
                    `;
                    item.onclick = () => preencherEditorBanner(data);
                    divLista.appendChild(item);
                });
            } catch (e) { divLista.innerHTML = "Erro."; }
        }

        function preencherEditorBanner(data) {
            document.getElementById('idBanner').value = data.id;
            document.getElementById('arquivoBanner').value = data.arquivo;
            document.getElementById('ordemBanner').value = data.ordem;
            mostrarStatus(`Editando Banner: ${data.id}`);
        }

        window.salvarBanner = async function() {
            let id = document.getElementById('idBanner').value.trim();
            const arquivo = document.getElementById('arquivoBanner').value;
            const ordem = parseInt(document.getElementById('ordemBanner').value) || 99;
            
            if(!arquivo) return alert("Nome do arquivo √© obrigat√≥rio");
            if(!id) id = "banner_" + Date.now(); // Gera ID se vazio

            await setDoc(doc(db, "listaBanners", id), { id, arquivo, ordem }, { merge: true });
            mostrarStatus("‚úÖ Banner Salvo!");
            carregarListaBanners();
            limparFormularioBanner();
        }

        window.deletarBanner = async function() {
            const id = document.getElementById('idBanner').value.trim();
            if(!id) return;
            if(confirm("Tem certeza que quer apagar este banner?")) {
                await deleteDoc(doc(db, "listaBanners", id));
                mostrarStatus("üóëÔ∏è Banner Removido.");
                carregarListaBanners();
                limparFormularioBanner();
            }
        }

        // --- UTILIT√ÅRIOS ---
        function mostrarStatus(msg) {
            const s = document.getElementById('status');
            s.style.display = 'block'; s.innerText = msg; s.style.background = '#d4edda';
            setTimeout(() => s.style.display = 'none', 3000);
        }
        window.limparFormulario = () => { document.querySelectorAll('#tab-jogos input').forEach(i => i.value = ''); }
        window.limparFormularioBanner = () => { document.querySelectorAll('#tab-banners input').forEach(i => i.value = ''); }

    </script>
</body>
</html>
